let CommandWrapper = ~/.config/command-wrapper/Types.dhall

let commandWrapper = ~/.config/command-wrapper/library.dhall

let noExtraEnvironment = commandWrapper.command.emptyEnvironment

in    λ(workingDirectory : Optional Text)
    → λ(prefixArguments : List Text)
    → λ(shell : CommandWrapper.Shell)
    → λ(index : Natural)
    → λ(words : List Text)
    → { command =
          "${env:HOME as Text}/.config/command-wrapper/exec/completion-bazel.bash"
      , arguments =
          let adjusted-index = index + (List/length Text prefixArguments)
          let shell = merge { Bash = "bash", Fish = "fish", Zsh = "zsh" } shell
          in    [ "--index=${Natural/show adjusted-index}"
                , "--shell=${shell}"
                , "--"
                , "bazel"
                ]
              # prefixArguments
              # words
      , environment =
          noExtraEnvironment
      , searchPath =
          False
      , workingDirectory =
          workingDirectory
      }

-- vim: filetype=dhall
